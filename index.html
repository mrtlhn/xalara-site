<!doctype html>
<html lang="en">
<head>
  <!-- Structured data: basic project -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": ["Organization", "WebSite"],
    "name": "Xalara (XALRA)",
    "url": "https://xalara.io",
    "logo": "https://xalara.io/assets/xalara-256.png",
  "sameAs": [
  "https://twitter.com/Xalara_Token",
  "https://t.me/Xalara_Token",
  "https://t.me/Xalara_Community",
  "https://etherscan.io/token/0x20F58aC708D2ebBA5f4B6f1687073f631714f9F3"
],
    "description": "ERC‚Äë20 token funding open biotech & longevity tooling with AI‚Äëassisted research bounties and community grants."
  }
  </script>

  <meta charset="utf-8" />
  <title>Xalara (XALRA) ‚Äî Official Site</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Xalara (XALRA) ‚Äî ERC‚Äë20 token for open biotech & longevity tooling, with AI‚Äëassisted research bounties and community grants." />
  <link rel="canonical" href="https://xalara.io/" />
  <meta name="robots" content="index,follow">

  <!-- Open Graph / Twitter -->
  <meta property="og:title" content="Xalara (XALRA)" />
  <meta property="og:description" content="Open biotech ‚Ä¢ Longevity ‚Ä¢ AI‚Äëassisted research. Contract, links, liquidity, and community roadmap." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://xalara.io/" />
  <meta property="og:site_name" content="Xalara" />
  <meta property="og:image" content="https://xalara.io/assets/xalara-256.png?v=2">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://xalara.io/assets/xalara-256.png?v=2">

  <!-- Identity / SEO helpers -->
  <meta name="theme-color" content="#0b0d12">
  <meta name="keywords" content="Xalara, XALRA, longevity, biotech, bioinformatics, AI, ERC-20, Ethereum">

  <!-- Favicon / app icons -->
  <link rel="icon" type="image/png" sizes="32x32"  href="/assets/xalara-32.png?v=2">
  <link rel="icon" type="image/png" sizes="192x192" href="/assets/xalara-256.png?v=2">
  <link rel="apple-touch-icon"                 href="/assets/xalara-256.png?v=2">

  <!-- Optional: advertise your tokenlist.json to tooling -->
  <!-- <link rel="alternate" type="application/json" href="/tokenlist.json"> -->

  <style>
    .topnav { margin-top: 6px; font-size: 14px; }

    :root {
      --bg:#0b0d12; --card:#111826; --text:#e7edf5; --muted:#9fb0c5;
      --accent:#6ee7ff; --accent2:#a78bfa; --ok:#a7f3d0; --warn:#ffd166;
      --line:#1b2535;
    }
    * { box-sizing: border-box; }
    body {
      margin:0; color:var(--text);
      font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial;
      background: radial-gradient(1200px 600px at 80% -10%, #1b2131 0%, #0b0d12 60%);
    }
    /* subtle lab grid overlay */
    body::before {
      content:""; position:fixed; inset:0; pointer-events:none; z-index:-1;
      background:
        repeating-linear-gradient(90deg, rgba(255,255,255,.03) 0 1px, transparent 1px 120px),
        repeating-linear-gradient(0deg,  rgba(255,255,255,.02) 0 1px, transparent 1px 120px);
      mask-image: radial-gradient(1200px 600px at 80% -10%, rgba(0,0,0,.6) 0, rgba(0,0,0,1) 60%);
    }
    .wrap { max-width: 980px; margin: 0 auto; padding: 24px; }
    header { padding: 24px 0 8px; }
    nav { display:flex; gap:12px; margin-top:8px; }
    nav a { color:#bcd1f0; font-size:14px; opacity:.9 }
    nav a:hover { opacity:1; }
    h1 { margin:0 0 6px; font-size: clamp(28px, 4vw, 40px); letter-spacing:.2px; }
    h2 {
      margin: 0 0 12px; font-size: clamp(20px, 2.5vw, 24px);
      position: relative; padding-left: 10px;
    }
    h2::before {
      content:""; position:absolute; left:0; top:6px; bottom:6px; width:4px;
      background: linear-gradient(180deg, var(--accent), var(--accent2));
      border-radius: 999px;
    }
    .subtitle { color:var(--muted); margin:0 0 18px; }
    .card {
      background:var(--card); border:1px solid var(--line); border-radius:14px;
      padding:18px; margin:16px 0; box-shadow: 0 10px 28px rgba(0,0,0,.35);
    }
    .grid { display:grid; gap:16px; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); }
    .kpis { display:grid; gap:12px; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); }
    .kpi {
      background:#0f1725; border:1px solid #1a2436; border-radius:12px; padding:12px;
    }
    .kpi .label { color:var(--muted); font-size:12px; text-transform: uppercase; letter-spacing:.08em; }
    .kpi .value { font-weight:700; font-size:18px; margin-top:4px; }
    code { background:#0e1320; border:1px solid #1b2233; padding:4px 8px; border-radius:8px;
           font-family: ui-monospace,SFMono-Regular,Menlo,Consolas,"Liberation Mono",monospace; color:#cfe1ff; word-break: break-all; }
    button { cursor: pointer; border:1px solid #2a3550; background:#141a29; color:#eaf2ff; padding:10px 14px; border-radius:10px; font-weight:600; transition:.15s ease; }
    button:hover { border-color:#3b4670; transform: translateY(-1px); }
    .btn-row { display:flex; flex-wrap:wrap; gap:10px; margin-top:10px; }
    .tag { display:inline-flex; align-items:center; gap:8px; padding:4px 10px; border-radius:999px; background:#0e1320; border:1px solid #1b2233; color:#cde0ff; font-size:13px; }
    .muted { color: var(--muted); }
    .warn  { color:var(--warn); }
    .ok    { color:var(--ok); }
    footer { color: var(--muted); font-size: 13px; padding: 18px 6px 36px; }
    a { color: #84c5ff; text-decoration: none; }
    a:hover { text-decoration: underline; }
    ul.clean { margin:0; padding-left:18px; }
    .phase li { margin:6px 0; }
    .chip { display:inline-block; padding:2px 8px; border:1px solid #22304a; border-radius:999px; background:#0e1524; font-size:12px; color:#bcd1f0; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>
        <img src="/assets/xalara-256.png?v=2" alt="XALARA"
             style="height:40px; vertical-align:middle; border-radius:8px; margin-right:8px">
        Xalara <span class="muted">(XALRA)</span>
      </h1>
      <p class="subtitle">Open Biotech ‚Ä¢ Longevity ‚Ä¢ AI‚Äëassisted research ¬∑ ERC‚Äë20 on <strong>Ethereum & Sepolia</strong></p>

<nav class="topnav">
  <a href="/about.html">About</a> ¬∑
  <a href="/press.html">Press</a> ¬∑
  <a href="/assets/xalara-litepaper-v1.pdf" target="_blank" rel="noopener">Litepaper (PDF)</a> ¬∑
  <a href="https://app.uniswap.org/#/swap?inputCurrency=ETH&outputCurrency=0x20F58aC708D2ebBA5f4B6f1687073f631714f9F3&chain=ethereum" target="_blank" rel="noopener">Uniswap</a> ¬∑
  <a href="https://twitter.com/Xalara_Token" target="_blank" rel="noopener">X (Twitter)</a> ¬∑
  <a href="https://t.me/Xalara_Token" target="_blank" rel="noopener">Telegram (Announcements)</a> ¬∑
  <a href="https://t.me/Xalara_Community" target="_blank" rel="noopener">Telegram (Community)</a>
</nav>





      <div id="networkNote" class="tag" style="margin-top:8px">Checking wallet network‚Ä¶</div>
    </header>

    <!-- Contract -->
    <section id="contract" class="card">
      <h2>Contract</h2>
      <div class="kpis">
        <div class="kpi">
          <div class="label">Mainnet address</div>
          <div class="value"><code id="addr">‚Äî</code></div>
        </div>
        <div class="kpi">
          <div class="label">Owner (Safe)</div>
          <div class="value"><code>0x5aBB817aaE8C17fBc97D2E2b4f08B35457aA1405</code></div>
        </div>
        <div class="kpi">
          <div class="label">Total supply</div>
          <div class="value">1,000,000,000 XALRA</div>
        </div>
      </div>
      <div class="btn-row">
        <button id="copy">Copy address</button>
        <a id="etherscan" class="tag" href="#" target="_blank" rel="noopener">View on Etherscan ‚Üó</a>
        <button id="add">Add XALRA to MetaMask</button>
      </div>
      <p class="muted" style="margin-top:10px">Standard: ERC‚Äë20 ¬∑ Features: Burnable ¬∑ Pausable ¬∑ EIP‚Äë2612 Permit ¬∑ 18 decimals</p>
    </section>

    <!-- Mission & Focus Areas -->
    <section class="card">
      <h2>Mission & Focus Areas</h2>
      <p class="muted">Xalara funds open tools and small grants at the intersection of <strong>biotechnology</strong>, <strong>longevity</strong>, and <strong>AI</strong>. We prioritize transparent, reproducible work.</p>
      <div class="grid">
        <div>
          <p>üß¨ <strong>Longevity R&D</strong><br>
          Community‚Äëdriven experiments and datasets for healthspan ‚Äî from assay curation to biomarker exploration.</p>
        </div>
        <div>
          <p>ü§ñ <strong>AI for Bioinformatics</strong><br>
          Lightweight pipelines to help non‚Äëexperts run analyses, with reproducible notebooks and synthetic data where needed.</p>
        </div>
        <div>
          <p>ü§ù <strong>Open Grants & Bounties</strong><br>
          Micro‚Äëgrants for useful tools (data cleaning, viz, literature triage) and reproducibility rewards.</p>
        </div>
      </div>
    </section>
    <section class="card" id="docs">
  <h2>Documents</h2>
  <ul class="clean">
    <li>
      <a href="/assets/xalara-litepaper-v1.pdf" target="_blank" rel="noopener">
        Xalara Litepaper v1 (PDF)
      </a> ‚Äî 2025‚Äë10‚Äë08
    </li>
  </ul>
</section>


    <!-- Liquidity status -->
    <section class="card" id="liqCard">
      <h2>Liquidity</h2>
      <p class="muted">
        Status: <strong id="liqStatus">Unlocked</strong>
        ¬∑ Plan: lock/burn on <span id="liqDate">TBD</span><br>
        Pair: <a id="pairLink" href="#" target="_blank" rel="noopener">Etherscan ‚Üó</a>
        ¬∑ LP in Safe: <a id="lpHoldLink" href="#" target="_blank" rel="noopener">view balance ‚Üó</a>
      </p>
      <p class="muted" style="margin-top:6px">
        We‚Äôll announce the exact time window ‚â•24h in advance and post a proof link here and on X after the action.
      </p>
    </section>

    <!-- Supply (from API) -->
    <section class="card" id="supplyCard">
      <h2>Supply</h2>
      <div class="kpis">
        <div class="kpi"><div class="label">Circulating</div><div class="value" id="circNow">‚Äî</div></div>
        <div class="kpi"><div class="label">Excluded (Safe)</div><div class="value" id="exSafe">‚Äî</div></div>
        <div class="kpi"><div class="label">Excluded (Deployer)</div><div class="value" id="exEoa">‚Äî</div></div>
      </div>
      <p class="muted" style="margin-top:6px">Source: <code>/api/circulating</code></p>
    </section>

    <!-- Pool snapshot (reads on-chain) -->
    <section class="card" id="pool">
      <h2>Pool Snapshot (Uniswap v2)</h2>
      <div class="kpis">
        <div class="kpi"><div class="label">Reserve (XALRA)</div><div class="value" id="resXalra">‚Äî</div></div>
        <div class="kpi"><div class="label">Reserve (ETH)</div><div class="value" id="resEth">‚Äî</div></div>
        <div class="kpi"><div class="label">Mid price</div><div class="value" id="midPrice">‚Äî</div></div>
        <div class="kpi"><div class="label">LP in Safe</div><div class="value" id="lpSafe">‚Äî</div></div>
      </div>
      <p class="muted" style="margin-top:6px">Indicative; computed from pair reserves (ETH per XALRA). Not price advice.</p>
    </section>

    <!-- Provenance -->
    <section class="card">
      <h2>Provenance</h2>
      <div class="grid">
        <div>
          <ul class="clean">
            <li>Contract verified: <a href="https://etherscan.io/address/0x20F58aC708D2ebBA5f4B6f1687073f631714f9F3#code" target="_blank" rel="noopener">Etherscan</a></li>
            <li>Liquidity pair: <code>0x87D0F6e909C459B1dA253F1A9570cceC8F59Bb91</code></li>
            <li>Router: <code>UniswapV2Router02</code></li>
          </ul>
        </div>
        <div>
          <ul class="clean">
            <li>Owner (mainnet): Safe multisig <code>0x5aBB‚Ä¶1405</code></li>
            <li>No transfer taxes; fixed supply at deploy</li>
            <li>Open data ethos; reproducible notebooks</li>
          </ul>
        </div>
      </div>
      <p class="muted" style="margin-top:8px"><strong>Note:</strong> XALRA is not an investment and makes no promises of returns or medical outcomes.</p>
    </section>

    <!-- Roadmap & Community targets -->
    <section class="card" id="roadmap">
      <h2>Roadmap & Community Targets</h2>
      <ul class="phase">
        <li>‚úÖ <strong>Phase 0</strong>: Deploy, verify, Safe owner, initial Uniswap v2 pool.</li>
        <li>üß™ <strong>Phase 1</strong> ‚Äî <span class="chip">100 X followers</span> or <span class="chip">50 holders</span>:
          publish a 4‚Äëpage litepaper + first demo notebook.</li>
        <li>üî≠ <strong>Phase 2</strong> ‚Äî <span class="chip">250 X followers</span> or <span class="chip">150 holders</span>:
          open first micro‚Äëgrants (tooling / data curation); announce LP lock schedule.</li>
        <li>üß¨ <strong>Phase 3</strong> ‚Äî <span class="chip">500 X followers</span> or <span class="chip">300 holders</span>:
          lock a portion of LP (eg. 3 months) and ship two reproducible examples.</li>
        <li>üåê <strong>Phase 4</strong> ‚Äî <span class="chip">1k X followers</span> or <span class="chip">500 holders</span>:
          scale grants; community voting on the next research bounties.</li>
      </ul>
      <p class="muted" style="margin-top:8px">Targets are directional; timing subject to gas & operational constraints. We‚Äôll announce each step publicly with links and proofs.</p>
    </section>

    <!-- Grants & Bounties -->
    <section class="card" id="grants">
      <h2>Grants & Bounties</h2>
      <p>We prioritize useful, reproducible outputs over speculation. Examples:</p>
      <ul class="clean">
        <li>üõ†Ô∏è A script to normalize publicly available aging biomarker datasets</li>
        <li>üìä A compact dashboard rendering key pool/holder on‚Äëchain stats</li>
        <li>üß† A tutorial notebook comparing 2‚Äì3 ML methods on a longevity dataset</li>
      </ul>
      <p class="muted" style="margin-top:8px">Propose a bounty or apply: <a href="mailto:xalara.project@gmail.com">xalara.project@gmail.com</a> ¬∑ <a href="https://twitter.com/Xalara_Token" target="_blank" rel="noopener">Twitter</a></p>
    </section>

    <!-- How to Buy (Mainnet) -->
    <section class="card" id="howto">
      <h2>How to buy XALRA</h2>
      <ol style="margin:0; padding-left:18px">
        <li>Open <a id="buyUniswap" target="_blank" rel="noopener">Uniswap on Ethereum</a>.</li>
        <li>In the token selector, paste the XALRA address:
          <code>0x20F58aC708D2ebBA5f4B6f1687073f631714f9F3</code>.
        </li>
        <li>Select <strong>ETH ‚Üí XALRA</strong>, set slippage to <strong>0.5‚Äì1%</strong>, and swap.</li>
      </ol>
      <p class="muted" style="margin-top:10px">
        Tip: If Uniswap shows ‚ÄúUnknown token‚Äù, click ‚ÄúImport‚Äù (normal for new tokens).
        Always verify the contract address.
      </p>
    </section>

    <!-- Trade (Mainnet) -->
    <section class="card" id="trade">
      <h2>Trade</h2>
      <p class="muted">Mainnet links for convenience.</p>
      <ul style="margin:0; padding-left:18px">
        <li><a id="swapLink"   target="_blank" rel="noopener">Swap ETH ‚Üí XALRA on Uniswap ‚Üó</a></li>
        <li><a id="addLiqLink" target="_blank" rel="noopener">Add liquidity (ETH + XALRA) ‚Üó</a></li>
        <li><a id="pairInfoLink" target="_blank" rel="noopener">View pool on a DEX tracker ‚Üó</a>
          <span class="muted" style="font-size:12px"> (set once you have the pair address)</span></li>
      </ul>
    </section>

    <!-- Sepolia demo -->
    <section class="card" id="try">
      <h2>Try it (Demo ‚Äî Sepolia)</h2>
      <div class="btn-row">
        <button id="connect">Connect wallet</button>
        <button id="switch">Switch to Sepolia</button>
        <button id="addToken">Add XALRA to MetaMask</button>
      </div>
      <p id="addrRow" class="muted" style="display:none">Wallet: <code id="walletAddr">‚Äì</code></p>
      <p>My XALRA balance: <strong id="myBalance">‚Äì</strong></p>
      <div style="margin-top:12px">
        <label>Send to: <input id="to" placeholder="0x..." style="width:340px"></label>
        <label style="margin-left:10px">Amount (XALRA): <input id="amount" type="number" step="0.0001" min="0" style="width:140px"></label>
        <label class="tag" style="margin-top:8px; display:inline-flex; gap:8px; align-items:center;">
          <input type="checkbox" id="enableSend"> Enable sending
        </label>
        <button id="send">Send</button>
        <p class="muted" style="margin-top:6px">
          Safety: if you enter more than 100 XALRA, you‚Äôll be asked to confirm.
        </p>
      </div>
      <p class="muted" id="txStatus"></p>
    </section>

    <!-- Balances (read-only) -->
    <section class="card" id="balancesCard">
      <h2>Balances</h2>
      <p class="muted">
        Read-only via your wallet provider. Enter addresses (one per line or separated by commas),
        then click <strong>Refresh</strong>. Your connected wallet will be added automatically.
      </p>

      <textarea id="addrList" rows="4" style="width:100%; background:#0e1320; color:#cfe1ff;
        border:1px solid #1b2233; border-radius:8px; padding:8px;">
0x3Ba4a3CeDAA7f10791BEA807eA03Ef808Fb3b31b
      </textarea>

      <div class="btn-row">
        <button id="refreshBalances">Refresh</button>
        <button id="clearBalances" style="opacity:.85">Clear</button>
      </div>

      <div id="balancesList" style="margin-top:8px"></div>
      <p class="muted">Total (listed): <strong id="balancesTotal">‚Äì</strong> XALRA</p>
    </section>

    <!-- Owner tools -->
    <section id="ownerCard" class="card" style="display:none">
      <h2>Owner Tools</h2>
      <div class="tag">Status: <strong id="ownerStatus">Checking‚Ä¶</strong></div>
      <div class="btn-row" style="margin-top:12px">
        <button id="pauseBtn">Pause transfers</button>
        <button id="unpauseBtn">Unpause transfers</button>
        <button id="renounceBtn" disabled title="Disabled for safety">Renounce ownership (disabled)</button>
      </div>
      <div id="ownerConnect" class="btn-row" style="display:none; margin-top:12px">
        <button id="ownerConnectBtn">Connect wallet</button>
      </div>
      <p class="muted" style="margin-top:10px">
        Visible only to the owner on the <em>current chain</em>. Actions require gas.
      </p>
    </section>

  <footer>
  ¬© <span id="year"></span> Xalara ¬∑ Network: <span id="footerNet">‚Äî</span><br>
  <a href="https://twitter.com/Xalara_Token" target="_blank" rel="noopener">Twitter</a> ¬∑
  <a href="mailto:xalara.project@gmail.com">Email</a> ¬∑
  <a href="https://etherscan.io/address/0x20F58aC708D2ebBA5f4B6f1687073f631714f9F3#code" target="_blank" rel="noopener">Etherscan</a> ¬∑
  <a href="/about.html">About</a> ¬∑
  <a href="/press.html">Press</a> ¬∑
  <a href="https://t.me/Xalara_Token" target="_blank" rel="noopener">Telegram (Announcements)</a> ¬∑
  <a href="https://t.me/Xalara_Community" target="_blank" rel="noopener">Telegram (Community)</a>
  <p class="muted" style="margin-top:8px">
    Security: owner is a Safe multisig (<code>0x5aBB‚Ä¶1405</code>); liquidity currently <strong>unlocked</strong>.
    We plan to <strong>lock or burn</strong> LP at the first community milestone and post the proof link here and on X.
  </p>
</footer>



  </div>

  <!-- ethers.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.13.2/dist/ethers.umd.min.js" crossorigin="anonymous"></script>

  <!-- App logic -->
  <script>
  (function () {
    // === MAINNET ADDRESSES / LINKS ===
    const MAINNET_TOKEN = "0x20F58aC708D2ebBA5f4B6f1687073f631714f9F3";
    const UNIV2_ROUTER  = "0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D";
    const MAINNET_PAIR  = "0x87D0F6e909C459B1dA253F1A9570cceC8F59Bb91";
    const SAFE_ADDR     = "0x5aBB817aaE8C17fBc97D2E2b4f08B35457aA1405";

    // Optional: flip Liquidity status automatically when you have proof
    const PLANNED_LIQ_ACTION_DATE = "";  // e.g., "2025-03-01"
    const LP_BURN_TX = "";               // e.g., "0xabc..."
    const LP_LOCK_PROOF_URL = "";        // e.g., "https://app.unicrypt.network/lock/..."

    // Public mainnet RPC for read-only snapshot
    const MAINNET_RPC = "https://cloudflare-eth.com";

    // === OWNERS PER CHAIN ===
    const OWNERS = {
      1:        SAFE_ADDR.toLowerCase(),
      11155111: "0x3Ba4a3CeDAA7f10791BEA807eA03Ef808Fb3b31b".toLowerCase(),
    };

    // === NETWORKS ===
    const NETS = {
      1: { name: "Ethereum Mainnet", chainIdHex: "0x1", explorer: "https://etherscan.io",
           contract: MAINNET_TOKEN, pass: null },
      11155111: { name: "Sepolia", chainIdHex: "0xaa36a7", explorer: "https://sepolia.etherscan.io",
           contract: "0x6cC3acc5A3AA8988C67285fb7954Cd51EC9B5F16",
           pass: "0x0366Fbc855907e3c089bDFA014FBF3c42CB6aC11" },
    };

    let CURRENT = NETS[11155111]; // default to Sepolia until wallet is read

    // === ABIs ===
    const TOKEN_ABI = [
      "function name() view returns (string)",
      "function symbol() view returns (string)",
      "function decimals() view returns (uint8)",
      "function totalSupply() view returns (uint256)",
      "function balanceOf(address) view returns (uint256)",
      "function transfer(address,uint256) returns (bool)",
      "function approve(address,uint256) returns (bool)"
    ];
    const OWNER_ABI = [
      "function paused() view returns (bool)",
      "function pause()", "function unpause()", "function owner() view returns (address)"
    ];
    const PASS_ABI = [
      "function mintWithBurn() returns (uint256)",
      "function balanceOf(address) view returns (uint256)",
      "function tokenURI(uint256) view returns (string)",
      "function burnPerPass() view returns (uint256)"
    ];
    const PAIR_ABI = [
      "function token0() view returns (address)",
      "function token1() view returns (address)",
      "function getReserves() view returns (uint112,uint112,uint32)",
      "function totalSupply() view returns (uint256)",
      "function balanceOf(address) view returns (uint256)"
    ];

    // === HELPERS ===
    const $ = (id) => document.getElementById(id);
    const note = (msg) => { const el = $("txStatus"); if (el) el.textContent = msg; console.log("[XALRA]", msg); };
    const notePass = (msg) => { const el = $("passStatus"); if (el) el.textContent = msg; console.log("[PASS]", msg); };
    const cleanError = (e) => (e?.error?.message || e?.data?.message || e?.message || String(e)).replace(/^execution reverted:? /i, "");

    function updateTradeLinks() {
      const buyUniswap   = $("buyUniswap");
      const swapLink     = $("swapLink");
      const addLiqLink   = $("addLiqLink");
      const pairInfoLink = $("pairInfoLink");

      const swapUrl = `https://app.uniswap.org/#/swap?inputCurrency=ETH&outputCurrency=${MAINNET_TOKEN}&chain=ethereum`;
      const addUrl  = `https://app.uniswap.org/#/add/v2/ETH/${MAINNET_TOKEN}?chain=ethereum`;

      if (buyUniswap) buyUniswap.href = swapUrl;
      if (swapLink)   swapLink.href   = swapUrl;
      if (addLiqLink) addLiqLink.href = addUrl;
      if (pairInfoLink && MAINNET_PAIR) pairInfoLink.href = `https://dexscreener.com/ethereum/${MAINNET_PAIR}`;
    }

    function wireLiquiditySection() {
      const statusEl = $("liqStatus"), dateEl = $("liqDate");
      const pairA = $("pairLink"), lpHoldA = $("lpHoldLink");

      if (pairA)   pairA.href   = `https://etherscan.io/address/${MAINNET_PAIR}`;
      if (lpHoldA) lpHoldA.href = `https://etherscan.io/token/${MAINNET_PAIR}?a=${SAFE_ADDR}`;
      if (dateEl)  dateEl.textContent = PLANNED_LIQ_ACTION_DATE || "TBD";

      if (statusEl) {
        if (LP_BURN_TX) {
          statusEl.innerHTML = `Locked (burn) ¬∑ <a href="https://etherscan.io/tx/${LP_BURN_TX}" target="_blank" rel="noopener">proof ‚Üó</a>`;
        } else if (LP_LOCK_PROOF_URL) {
          statusEl.innerHTML = `Locked (locker) ¬∑ <a href="${LP_LOCK_PROOF_URL}" target="_blank" rel="noopener">proof ‚Üó</a>`;
        } else {
          statusEl.textContent = "Unlocked";
        }
      }
    }

    // --- Supply (from API) ---
    async function updateSupply() {
      try {
        const res = await fetch("/api/circulating?format=human", { cache: "no-store" });
        if (!res.ok) throw new Error("API error");
        const data = await res.json();
        const num = (s) => Number(s);

        const circ = num(data.circulating);
        const safe = num(data.excluded?.safe?.balance ?? 0);
        const eoa  = num(data.excluded?.deployer?.balance ?? 0);

        const fmt = (x) => x.toLocaleString(undefined, { maximumFractionDigits: 6 });

        $("circNow").textContent = fmt(circ);
        $("exSafe").textContent  = fmt(safe);
        $("exEoa").textContent   = fmt(eoa);
      } catch (e) {
        console.warn("Supply fetch failed:", e);
        $("circNow").textContent = "‚Äî";
        $("exSafe").textContent  = "‚Äî";
        $("exEoa").textContent   = "‚Äî";
      }
    }

    // --- Pool snapshot (no wallet needed) ---
   async function updatePoolSnapshot() {
    try {
      const res = await fetch("/api/pool?format=human", { cache: "no-store" });
      if (!res.ok) throw new Error("API error");
      const d = await res.json();

      const fmt = (x) => Number(x).toLocaleString(undefined, { maximumFractionDigits: 6 });

      document.getElementById("resXalra").textContent = fmt(d.reserveXalra);
      document.getElementById("resEth").textContent   = fmt(d.reserveEth);
      document.getElementById("midPrice").textContent = `${Number(d.priceEthPerXalra).toPrecision(6)} ETH / XALRA`;
      document.getElementById("lpSafe").textContent   = `${d.lpSafe} / ${d.lpTotal}`;
    } catch (err) {
      console.warn("Pool snapshot failed:", err);
      ["resXalra","resEth","midPrice","lpSafe"].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.textContent = "‚Äî";
      });
    }
  }


    async function ensureChain(chainIdHex) {
      if (!window.ethereum) throw new Error("Wallet not detected");
      const id = await window.ethereum.request({ method: "eth_chainId" });
      if (id !== chainIdHex) {
        try {
          await window.ethereum.request({ method: "wallet_switchEthereumChain", params: [{ chainId: chainIdHex }] });
        } catch (e) {
          if (e && e.code === 4902) {
            const net = Object.values(NETS).find(n => n.chainIdHex === chainIdHex);
            await window.ethereum.request({
              method: "wallet_addEthereumChain",
              params: [{
                chainId: chainIdHex,
                chainName: net?.name || "Ethereum",
                nativeCurrency: { name: "ETH", symbol: "ETH", decimals: 18 },
                rpcUrls: ["https://rpc.sepolia.org"],
                blockExplorerUrls: [net?.explorer || "https://etherscan.io"],
              }],
            });
          } else { throw e; }
        }
      }
    }

    // Update CURRENT and UI based on wallet chain
    async function setCurrentByWallet() {
      const badge = $("networkNote"), addrEl = $("addr"), escan = $("etherscan"), footerNet = $("footerNet");
      const passCard = $("pass"), passScan = $("passScan");
      const tryCard = $("try"), sendBtn = $("send"), enableCb = $("enableSend"), txStatus = $("txStatus");

      if (!window.ethereum) {
        CURRENT = NETS[11155111];
      } else {
        const idHex = await window.ethereum.request({ method: "eth_chainId" });
        const id = parseInt(idHex, 16);
        CURRENT = NETS[id] || NETS[11155111];
      }

      if (addrEl) addrEl.textContent = CURRENT.contract;
      if (escan) escan.href = `${CURRENT.explorer}/address/${CURRENT.contract}#code`;
      if (badge) badge.textContent = `Wallet network: ${CURRENT.name} ‚úì`;
      if (footerNet) footerNet.textContent = CURRENT.name;

      // Pass card (Sepolia only) ‚Äî safe if the element doesn't exist
      if (passCard) {
        const onSepolia = CURRENT === NETS[11155111];
        passCard.style.display = onSepolia ? "block" : "none";
        if (onSepolia && passScan) passScan.href = `${NETS[11155111].explorer}/address/${NETS[11155111].pass}#code`;
      }

      // Demo Try panel: disabled on mainnet
      if (tryCard && sendBtn) {
        const onMainnet = CURRENT === NETS[1];
        sendBtn.disabled = onMainnet || !(enableCb?.checked);
        if (txStatus) {
          txStatus.textContent = onMainnet ? "Demo transfers are only enabled on Sepolia." : "";
        }
      }
    }

    if (window.ethereum?.on) {
      window.ethereum.on("chainChanged", setCurrentByWallet);
    }

    function onLoad() {
      if ($("year")) $("year").textContent = new Date().getFullYear();

      setCurrentByWallet();
      updateTradeLinks();
      wireLiquiditySection();

      // Initial data pulls + periodic refresh
      updateSupply();
      updatePoolSnapshot();
      setInterval(updateSupply,       60_000);
      setInterval(updatePoolSnapshot, 60_000);

      // Contract card buttons
      $("copy")?.addEventListener("click", async () => {
        try {
          await navigator.clipboard.writeText(CURRENT.contract);
          const btn = $("copy"); const old = btn.textContent; btn.textContent = "Copied!"; setTimeout(() => btn.textContent = old, 1200);
        } catch {}
      });
      $("add")?.addEventListener("click", async () => {
        if (!window.ethereum) return alert("MetaMask not detected.");
        try {
          await window.ethereum.request({
            method: "wallet_watchAsset",
            params: { type: "ERC20", options: { address: CURRENT.contract, symbol: "XALRA", decimals: 18 } }
          });
        } catch (e) { alert(cleanError(e)); }
      });

      // ---- Sepolia demo (send) ----
      let provider, signer, token;
      const btnConnect  = $("connect");
      const btnSwitch   = $("switch");
      const btnAddToken = $("addToken");
      const btnSend     = $("send");
      let lastSendAt = 0;
      const SEND_COOLDOWN_MS = 8000;

      async function connect() {
        if (!window.ethereum) throw new Error("MetaMask not detected");
        provider = new ethers.BrowserProvider(window.ethereum);
        await window.ethereum.request({ method: "eth_requestAccounts" });
        await ensureChain(NETS[11155111].chainIdHex);
        await setCurrentByWallet();

        signer = await provider.getSigner();
        token  = new ethers.Contract(CURRENT.contract, TOKEN_ABI, signer);

        const addr = await signer.getAddress();
        $("walletAddr") && ($("walletAddr").textContent = addr);
        $("addrRow") && ( $("addrRow").style.display = "block" );

        const bal = await token.balanceOf(addr);
        $("myBalance") && ( $("myBalance").textContent = ethers.formatUnits(bal, 18) );

        note("Connected.");
        await updateOwnerUI();
      }

      const tryEls = { card:$("try"), sendBtn:$("send"), enable:$("enableSend"), status:$("txStatus") };

      async function refreshPaused() {
        if (!window.ethereum) return;
        try {
          const pro = new ethers.BrowserProvider(window.ethereum);
          const c = new ethers.Contract(CURRENT.contract, ["function paused() view returns (bool)"], pro);
          const paused = await c.paused();
          setTryPaused(paused);
        } catch {}
      }
      function setTryPaused(paused) {
        if (!tryEls.card) return;
        tryEls.card.style.opacity = paused ? 0.6 : 1;
        const enabledToggle = tryEls.enable?.checked ?? false;
        if (tryEls.sendBtn) tryEls.sendBtn.disabled = paused || !enabledToggle || (CURRENT === NETS[1]);
        if (tryEls.status) {
          tryEls.status.textContent = (CURRENT === NETS[1])
            ? "Demo transfers are only enabled on Sepolia."
            : (paused ? "Token is paused: transfers are disabled." : "");
        }
      }

      if (tryEls.enable && tryEls.sendBtn) {
        tryEls.sendBtn.disabled = true;
        tryEls.enable.addEventListener("change", refreshPaused);
      }
      if (window.ethereum?.on) {
        window.ethereum.on("accountsChanged", refreshPaused);
        window.ethereum.on("chainChanged",   refreshPaused);
      }
      refreshPaused();

      btnConnect && (btnConnect.onclick = () => connect().catch(e => note(cleanError(e))));
      btnSwitch  && (btnSwitch.onclick  = () => {
        if (!window.ethereum) { note("MetaMask not detected"); return; }
        window.ethereum.request({ method: "wallet_switchEthereumChain", params: [{ chainId: NETS[11155111].chainIdHex }] })
          .catch(e => note(cleanError(e)));
      });
      btnAddToken && (btnAddToken.onclick = async () => {
        try {
          if (!window.ethereum) throw new Error("MetaMask not detected");
          await window.ethereum.request({
            method: "wallet_watchAsset",
            params: { type: "ERC20", options: { address: CURRENT.contract, symbol: "XALRA", decimals: 18 } }
          });
        } catch (e) { note(cleanError(e)); }
      });

      btnSend && (btnSend.onclick = async () => {
        try {
          if (CURRENT !== NETS[11155111]) { note("Demo transfers are only enabled on Sepolia."); return; }
          if (!tryEls.enable?.checked) { note("Toggle ‚ÄúEnable sending‚Äù first."); return; }
          const now = Date.now();
          if (now - lastSendAt < SEND_COOLDOWN_MS) {
            const wait = Math.ceil((SEND_COOLDOWN_MS - (now - lastSendAt)) / 1000);
            note(`Please wait ${wait}s before sending again.`); return;
          }
          if (!signer) await connect();

          const to = ($("to")?.value || "").trim();
          const amtStr = ($("amount")?.value || "").trim();
          if (!ethers.isAddress(to)) throw new Error("Invalid recipient address");
          if (!amtStr || Number(amtStr) <= 0) throw new Error("Enter a positive amount");

          const providerRO = new ethers.BrowserProvider(window.ethereum);
          const pausedReader = new ethers.Contract(CURRENT.contract, ["function paused() view returns (bool)"], providerRO);
          if (await pausedReader.paused()) throw new Error("Token is paused");

          const value = ethers.parseUnits(amtStr, 18);

          const SOFT_CAP = ethers.parseUnits("100", 18);
          if (value > SOFT_CAP) {
            const ok = confirm("This is a demo site. Are you sure you want to send more than 100 XALRA?");
            if (!ok) return;
          }

          const sender = await signer.getAddress();
          const bal = await token.balanceOf(sender);
          if (value > bal) throw new Error(`Amount exceeds your balance (${ethers.formatUnits(bal, 18)} XALRA)`);

          note("Sending‚Ä¶");
          const tx = await token.transfer(to, value);
          lastSendAt = Date.now();

          const hash = tx.hash;
          const el = $("txStatus");
          const txUrl = `${CURRENT.explorer}/tx/${hash}`;
          if (el && /^0x[0-9a-fA-F]{64}$/.test(hash)) {
            el.innerHTML = `Pending: <a href="${txUrl}" target="_blank" rel="noopener">${hash.slice(0,10)}‚Ä¶</a>`;
          } else {
            note("Pending: " + hash);
          }

          const rcpt = await tx.wait();
          if (el) {
            el.innerHTML = `Confirmed in block ${rcpt.blockNumber}. <a href="${txUrl}" target="_blank" rel="noopener">View on Etherscan</a>`;
          } else {
            note(`Confirmed in block ${rcpt.blockNumber}. Tx: ${hash}`);
          }

          const newBal = await token.balanceOf(sender);
          $("myBalance") && ( $("myBalance").textContent = ethers.formatUnits(newBal, 18) );
          await refreshPaused();
        } catch (e) {
          note(cleanError(e));
        }
      });

      // Owner tools (Sepolia only for direct calls)
      const ownerEls = { card:$("ownerCard"), status:$("ownerStatus"), connectRow:$("ownerConnect"),
                         connectBtn:$("ownerConnectBtn"), pauseBtn:$("pauseBtn"), unpauseBtn:$("unpauseBtn") };

      async function getAccounts() {
        if (!window.ethereum) return [];
        try { return await window.ethereum.request({ method: "eth_accounts" }); }
        catch { return []; }
      }

      async function updateOwnerUI() {
        if (!ownerEls.card) return;
        if (!window.ethereum) { ownerEls.card.style.display = "none"; ownerEls.connectRow.style.display = "none"; return; }

        let chainId = 11155111;
        try { chainId = parseInt(await window.ethereum.request({ method: "eth_chainId" }), 16); } catch {}
        const accounts = await getAccounts();
        const acct = (accounts[0] || "").toLowerCase();
        const ownerForChain = OWNERS[chainId] || "";
        const isOwner = acct === ownerForChain;

        if (!isOwner || chainId === 1) {
          ownerEls.card.style.display = "none";
          ownerEls.connectRow.style.display = "block";
          return;
        }

        ownerEls.card.style.display = "block";
        ownerEls.connectRow.style.display = "none";

        try {
          const providerO = new ethers.BrowserProvider(window.ethereum);
          const signerO   = await providerO.getSigner();
          const c = new ethers.Contract(CURRENT.contract, OWNER_ABI, signerO);
          const paused = await c.paused();
          ownerEls.status.textContent = paused ? "Paused" : "Active";
          ownerEls.status.style.color = paused ? "#ffd166" : "#a7f3d0";
        } catch {
          ownerEls.status.textContent = "Error";
          ownerEls.status.style.color = "#ffd166";
        }
      }

      ownerEls.connectBtn?.addEventListener("click", async () => {
        if (!window.ethereum) { alert("No wallet found"); return; }
        try {
          await window.ethereum.request({ method: "eth_requestAccounts" });
          await updateOwnerUI();
        } catch (e) { alert(cleanError(e)); }
      });

      ownerEls.pauseBtn?.addEventListener("click", async () => {
        try {
          if (!window.ethereum) return alert("No wallet");
          const providerO = new ethers.BrowserProvider(window.ethereum);
          const signerO   = await providerO.getSigner();
          const c = new ethers.Contract(CURRENT.contract, OWNER_ABI, signerO);
          ownerEls.status.textContent = "Pausing‚Ä¶";
          const tx = await c.pause();
          await tx.wait();
          ownerEls.status.textContent = "Paused";
          ownerEls.status.style.color = "#ffd166";
        } catch (e) { alert(cleanError(e)); await updateOwnerUI(); }
      });

      ownerEls.unpauseBtn?.addEventListener("click", async () => {
        try {
          if (!window.ethereum) return alert("No wallet");
          const providerO = new ethers.BrowserProvider(window.ethereum);
          const signerO   = await providerO.getSigner();
          const c = new ethers.Contract(CURRENT.contract, OWNER_ABI, signerO);
          ownerEls.status.textContent = "Unpausing‚Ä¶";
          const tx = await c.unpause();
          await tx.wait();
          ownerEls.status.textContent = "Active";
          ownerEls.status.style.color = "#a7f3d0";
        } catch (e) { alert(cleanError(e)); await updateOwnerUI(); }
      });

      if (window.ethereum?.on) {
        window.ethereum.on("accountsChanged", () => { updateOwnerUI(); });
        window.ethereum.on("chainChanged",   () => { updateOwnerUI(); setCurrentByWallet(); });
      }
      updateOwnerUI();
    }

    window.addEventListener("load", () => {
      if (typeof window.ethers === "undefined") {
        alert("Failed to load ethers.js");
      } else {
        onLoad();
      }
    });
  })();
  </script>
</body>
</html>

