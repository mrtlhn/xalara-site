<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Xalara (XALRA) — Official Site</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Xalara (XALRA) — ERC‑20 token on Sepolia. Contract, links, and wallet helpers." />
  <link rel="canonical" href="https://xalara.io/" />
  <meta property="og:title" content="Xalara (XALRA)" />
  <meta property="og:description" content="Official token page for Xalara (XALRA). Contract, links, and wallet helpers." />
  <meta property="og:type" content="website" />
  <style>
    :root { --bg:#0b0d12; --card:#121621; --text:#e7edf5; --muted:#98a3b3; --accent:#6ee7ff; --accent2:#a78bfa; }
    * { box-sizing: border-box; }
    body { margin:0; font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial; color:var(--text); background:radial-gradient(1200px 600px at 80% -10%, #1b2131 0%, #0b0d12 60%); }
    .wrap { max-width: 960px; margin: 0 auto; padding: 24px; }
    header { padding: 24px 0 8px; }
    h1 { margin:0 0 6px; font-size: clamp(28px, 4vw, 40px); letter-spacing:.2px; }
    .subtitle { color:var(--muted); margin:0 0 18px; }
    .card { background:var(--card); border:1px solid #1f2737; border-radius:14px; padding:18px; margin:16px 0; box-shadow: 0 8px 24px rgba(0,0,0,.35); }
    .grid { display:grid; gap:16px; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); }
    code { background:#0e1320; border:1px solid #1b2233; padding:4px 8px; border-radius:8px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; color:#cfe1ff; word-break: break-all; }
    button { cursor: pointer; border:1px solid #2a3550; background:#141a29; color:#eaf2ff; padding:10px 14px; border-radius:10px; font-weight:600; transition:.15s ease; }
    button:hover { border-color:#3b4670; transform: translateY(-1px); }
    .btn-row { display:flex; flex-wrap:wrap; gap:10px; margin-top:10px; }
    .tag { display:inline-flex; align-items:center; gap:8px; padding:4px 10px; border-radius:999px; background:#0e1320; border:1px solid #1b2233; color:#cde0ff; font-size:13px; }
    .muted { color: var(--muted); }
    .warn  { color:#ffd166; }
    footer { color: var(--muted); font-size: 13px; padding: 18px 6px 36px; }
    a { color: #84c5ff; text-decoration: none; }
    a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>⚡ Xalara <span class="muted">(XALRA)</span></h1>
      <p class="subtitle">Official site · ERC‑20 on <strong>Sepolia</strong> (testnet) · xalara.io</p>
      <div id="networkNote" class="tag">Checking wallet network…</div>
    </header>

    <!-- Contract card -->
    <section id="contract" class="card">
      <h2>Contract</h2>
      <p><strong>Address:</strong> <code id="addr">0x6cC3acc5A3AA8988C67285fb7954Cd51EC9B5F16</code></p>
      <div class="btn-row">
        <button id="copy">Copy address</button>
        <a id="etherscan" class="tag" href="https://sepolia.etherscan.io/address/0x6cC3acc5A3AA8988C67285fb7954Cd51EC9B5F16#code" target="_blank" rel="noopener">View on Etherscan ↗</a>
        <button id="add">Add XALRA to MetaMask</button>
      </div>
      <p class="muted" style="margin-top:10px">Symbol: <strong>XALRA</strong> · Decimals: <strong>18</strong> · Total Supply: <strong>1,000,000,000</strong></p>
    </section>

    <!-- About -->
    <section class="card">
      <h2>About Xalara</h2>
      <div class="grid">
        <div>
          <p><strong>Standard:</strong> ERC‑20</p>
          <p><strong>Features:</strong> Burnable, Pausable, Permit (EIP‑2612)</p>
          <p><strong>Owner:</strong> <code>0x3Ba4a3CeDAA7f10791BEA807eA03Ef808Fb3b31b</code></p>
        </div>
        <div>
          <p><strong>Source:</strong> Verified on Etherscan &amp; Sourcify</p>
          <ul>
            <li><a href="https://sepolia.etherscan.io/address/0x6cC3acc5A3AA8988C67285fb7954Cd51EC9B5F16#code" target="_blank" rel="noopener">Etherscan (Code)</a></li>
            <li><a href="https://repo.sourcify.dev/contracts/full_match/11155111/0x6cC3acc5A3AA8988C67285fb7954Cd51EC9B5F16/" target="_blank" rel="noopener">Sourcify</a></li>
          </ul>
        </div>
      </div>
    </section>

    <!-- Important -->
    <section class="card">
      <h2>Important</h2>
      <p class="warn">This is a <strong>Sepolia testnet</strong> token for development and demonstration. It has <strong>no financial value</strong> and is <strong>not an investment</strong>.</p>
    </section>

    <!-- Owner Tools (owner-only) -->
    <section id="ownerCard" class="card" style="display:none">
      <h2>Owner Tools</h2>
      <div class="tag">Status: <strong id="ownerStatus">Checking…</strong></div>
      <div class="btn-row" style="margin-top:12px">
        <button id="pauseBtn">Pause transfers</button>
        <button id="unpauseBtn">Unpause transfers</button>
        <button id="renounceBtn" disabled title="Disabled for safety">Renounce ownership (disabled)</button>
      </div>
      <div id="ownerConnect" class="btn-row" style="display:none; margin-top:12px">
        <button id="ownerConnectBtn">Connect wallet</button>
      </div>
      <p class="muted" style="margin-top:10px">
        Visible only to the owner <code>0x3Ba4…b31b</code>. Actions require Sepolia and small gas.
      </p>
    </section>

    <!-- Try it panel -->
    <section class="card" id="try">
      <h2>Try it (Sepolia)</h2>
      <div class="btn-row">
        <button id="connect">Connect wallet</button>
        <button id="switch">Switch to Sepolia</button>
        <button id="addToken">Add XALRA to MetaMask</button>
      </div>
      <p id="addrRow" class="muted" style="display:none">Wallet: <code id="walletAddr">–</code></p>
      <p>My XALRA balance: <strong id="myBalance">–</strong></p>
      <div style="margin-top:12px">
        <label>Send to: <input id="to" placeholder="0x..." style="width:340px"></label>
        <label style="margin-left:10px">Amount (XALRA): <input id="amount" type="number" step="0.0001" min="0" style="width:140px"></label>
        <label class="tag" style="margin-top:8px; display:inline-flex; gap:8px; align-items:center;">
  <input type="checkbox" id="enableSend">
  Enable sending
</label>

        <button id="send">Send</button>
        <div class="btn-row" style="margin-top:8px">
  <label class="muted">
    <input type="checkbox" id="enableSend"> I understand this sends from my connected wallet
  </label>
</div>
<p class="muted" style="margin-top:6px">
  Safety: capped at 100 XALRA unless you explicitly confirm a larger amount.
</p>

      </div>
      <p class="muted" id="txStatus"></p>
    </section>
    <!-- Balances (read-only) -->
<section class="card" id="balancesCard">
  <h2>Balances</h2>
  <p class="muted">
    Read-only via your wallet provider. Enter addresses (one per line or separated by commas),
    then click <strong>Refresh</strong>. Your connected wallet will be added automatically.
  </p>

  <textarea id="addrList" rows="4" style="width:100%; background:#0e1320; color:#cfe1ff;
    border:1px solid #1b2233; border-radius:8px; padding:8px;">
0x3Ba4a3CeDAA7f10791BEA807eA03Ef808Fb3b31b
  </textarea>

  <div class="btn-row">
    <button id="refreshBalances">Refresh</button>
    <button id="clearBalances" style="opacity:.85">Clear</button>
  </div>

  <div id="balancesList" style="margin-top:8px"></div>
  <p class="muted">Total (listed): <strong id="balancesTotal">–</strong> XALRA</p>
</section>


    <footer>
      © <span id="year"></span> Xalara · Contract: <code>0x6cC3…B5F16</code> · Network: Sepolia (chainId <code>11155111</code>)
    </footer>
  </div>

  <!-- ethers.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.13.2/dist/ethers.umd.min.js" crossorigin="anonymous"></script>

  <!-- App logic (runs after ethers is loaded) -->
  <script>
  (function () {
    // === CONFIG ===
    const CONTRACT = "0x6cC3acc5A3AA8988C67285fb7954Cd51EC9B5F16";  // Sepolia
    const CHAIN_ID_HEX = "0xaa36a7"; // 11155111
    const OWNER = "0x3Ba4a3CeDAA7f10791BEA807eA03Ef808Fb3b31b".toLowerCase();

    const TOKEN_ABI = [
      "function name() view returns (string)",
      "function symbol() view returns (string)",
      "function decimals() view returns (uint8)",
      "function totalSupply() view returns (uint256)",
      "function balanceOf(address) view returns (uint256)",
      "function transfer(address,uint256) returns (bool)"
    ];
    const OWNER_ABI = [
      "function paused() view returns (bool)",
      "function pause()",
      "function unpause()",
      "function owner() view returns (address)"
    ];

    // === HELPERS ===
    const $ = (id) => document.getElementById(id);
    const note = (msg) => { const el = $("txStatus"); if (el) el.textContent = msg; console.log("[XALRA]", msg); };
    const cleanError = (e) => (e?.error?.message || e?.data?.message || e?.message || String(e)).replace(/^execution reverted:? /i, "");

    async function ensureSepolia() {
      const id = await window.ethereum.request({ method: "eth_chainId" });
      if (id !== CHAIN_ID_HEX) {
        try {
          await window.ethereum.request({
            method: "wallet_switchEthereumChain",
            params: [{ chainId: CHAIN_ID_HEX }],
          });
        } catch (e) {
          if (e && e.code === 4902) {
            await window.ethereum.request({
              method: "wallet_addEthereumChain",
              params: [{
                chainId: CHAIN_ID_HEX,
                chainName: "Sepolia",
                nativeCurrency: { name: "Sepolia ETH", symbol: "ETH", decimals: 18 },
                rpcUrls: ["https://rpc.sepolia.org"],
                blockExplorerUrls: ["https://sepolia.etherscan.io"],
              }],
            });
          } else {
            throw e;
          }
        }
      }
    }

    function onLoad() {
      if ($("year")) $("year").textContent = new Date().getFullYear();

      // Contract card buttons
      const copyBtn = $("copy");
      if (copyBtn) copyBtn.onclick = async () => {
        try {
          await navigator.clipboard.writeText(CONTRACT);
          const old = copyBtn.textContent; copyBtn.textContent = "Copied!"; setTimeout(() => copyBtn.textContent = old, 1200);
        } catch {}
      };
      const addBtn = $("add");
      if (addBtn) addBtn.onclick = async () => {
        if (!window.ethereum) return alert("MetaMask not detected.");
        try {
          await window.ethereum.request({
            method: "wallet_watchAsset",
            params: { type: "ERC20", options: { address: CONTRACT, symbol: "XALRA", decimals: 18 } }
          });
        } catch (e) { alert(cleanError(e)); }
      };

      // Network badge
      (async () => {
        const el = $("networkNote");
        if (!el) return;
        if (!window.ethereum) { el.textContent = "MetaMask not detected"; return; }
        try {
          const id = await window.ethereum.request({ method: "eth_chainId" });
          el.textContent = (id === CHAIN_ID_HEX) ? "Wallet network: Sepolia ✓"
            : `Wallet network: not Sepolia (chainId ${parseInt(id,16)})`;
        } catch { el.textContent = "Could not read wallet network"; }
      })();

      // Try panel
      let provider, signer, token;
      async function connect() {
        if (!window.ethereum) throw new Error("MetaMask not detected");
        provider = new ethers.BrowserProvider(window.ethereum);
        await window.ethereum.request({ method: "eth_requestAccounts" });
        await ensureSepolia();
        signer = await provider.getSigner();
        token  = new ethers.Contract(CONTRACT, TOKEN_ABI, signer);

        const addr = await signer.getAddress();
        if ($("walletAddr")) $("walletAddr").textContent = addr;
        if ($("addrRow")) $("addrRow").style.display = "block";

        const bal = await token.balanceOf(addr);
        if ($("myBalance")) $("myBalance").textContent = ethers.formatUnits(bal, 18);

        note("Connected to Sepolia.");
        await updateOwnerUI(); // refresh owner card if this is the owner
      }

      const btnConnect  = $("connect");
      const btnSwitch   = $("switch");
      const btnAddToken = $("addToken");
      const btnSend     = $("send");

      // === Try card pause-awareness + cooldown + explorer link ===
const EXPLORER = "https://sepolia.etherscan.io";
let lastSendAt = 0;
const SEND_COOLDOWN_MS = 8000;

const tryEls = {
  card: $("try"),
  sendBtn: $("send"),
  enable: $("enableSend"),
  status: $("txStatus"),
};

// Grey out/disable the Try card when paused
function setTryPaused(paused) {
  if (!tryEls.card) return;
  tryEls.card.style.opacity = paused ? 0.6 : 1;

  const enabledToggle = tryEls.enable?.checked ?? false;
  if (tryEls.sendBtn) tryEls.sendBtn.disabled = paused || !enabledToggle;

  if (tryEls.status) {
    tryEls.status.textContent = paused ? "Token is paused: transfers are disabled." : "";
  }
}

// Read paused() via the user's provider (no API key)
async function refreshPaused() {
  if (!window.ethereum) return;
  try {
    const provider = new ethers.BrowserProvider(window.ethereum);
    const c = new ethers.Contract(CONTRACT, ["function paused() view returns (bool)"], provider);
    const paused = await c.paused();
    setTryPaused(paused);
  } catch { /* ignore */ }
}

// Wire the toggle to control the Send button together with paused()
if (tryEls.enable && tryEls.sendBtn) {
  tryEls.sendBtn.disabled = true;              // default: disabled
  tryEls.enable.addEventListener("change", refreshPaused);
}

// Re-check on wallet changes too
if (window.ethereum?.on) {
  window.ethereum.on("chainChanged",  refreshPaused);
  window.ethereum.on("accountsChanged", refreshPaused);
}

// First paint
refreshPaused();


      // Explorer + cooldown
const EXPLORER = "https://sepolia.etherscan.io";
let lastSendAt = 0;
const SEND_COOLDOWN_MS = 8000;

// Elements used by the Try card
const tryEls = {
  card: $("try"),
  sendBtn: $("send"),
  enable: $("enableSend"),
  status: $("txStatus"),
};

// When paused, grey out the Try card and disable Send
function setTryPaused(paused) {
  if (!tryEls.card) return;
  tryEls.card.style.opacity = paused ? 0.6 : 1;
  if (tryEls.sendBtn) {
    const enabledToggle = tryEls.enable?.checked ?? false;
    tryEls.sendBtn.disabled = paused || !enabledToggle;
  }
  if (tryEls.status) {
    tryEls.status.textContent = paused ? "Token is paused: transfers are disabled." : "";
  }
}

// Read paused() using the user’s provider (no API key needed)
async function refreshPaused() {
  if (!window.ethereum) return;
  try {
    const provider = new ethers.BrowserProvider(window.ethereum);
    const c = new ethers.Contract(CONTRACT, ["function paused() view returns (bool)"], provider);
    const paused = await c.paused();
    setTryPaused(paused);
  } catch { /* ignore */ }
}

// Wire the “Enable sending” toggle so it re-checks pause state
if (tryEls.enable && tryEls.sendBtn) {
  tryEls.sendBtn.disabled = true;
  tryEls.enable.addEventListener("change", async () => {
    await refreshPaused();
  });
}

// Re‑check on wallet changes
if (window.ethereum?.on) {
  window.ethereum.on("chainChanged", refreshPaused);
  window.ethereum.on("accountsChanged", refreshPaused);
}
// First paint
refreshPaused();


      if (btnConnect) btnConnect.onclick = () => connect().catch(e => note(cleanError(e)));
      if (btnSwitch)  btnSwitch.onclick  = () => {
        if (!window.ethereum) { note("MetaMask not detected"); return; }
        window.ethereum.request({ method: "wallet_switchEthereumChain", params: [{ chainId: CHAIN_ID_HEX }] })
          .catch(e => note(cleanError(e)));
      };
      if (btnAddToken) btnAddToken.onclick = async () => {
        try {
          if (!window.ethereum) throw new Error("MetaMask not detected");
          await window.ethereum.request({
            method: "wallet_watchAsset",
            params: { type: "ERC20", options: { address: CONTRACT, symbol: "XALRA", decimals: 18 } }
          });
        } catch (e) { note(cleanError(e)); }
      };
      if (btnSend) btnSend.onclick = async () => {
       // Disable send until the user checks the box
const enableSend = $("enableSend");
if (btnSend) btnSend.disabled = true;
enableSend?.addEventListener("change", (e) => {
  if (btnSend) btnSend.disabled = !e.target.checked;
});

if (btnSend) btnSend.onclick = async () => {
  try {
    // Cooldown to prevent double-click
    if (Date.now() - lastSendAt < SEND_COOLDOWN_MS) {
      return note("Please wait a few seconds before sending again.");
    }

    if (!signer) await connect();
    const to = ($("to")?.value || "").trim();
    const amt = ($("amount")?.value || "").trim();
    if (!ethers.isAddress(to)) throw new Error("Invalid recipient address");

    // Respect pause
    const provider = new ethers.BrowserProvider(window.ethereum);
    const pausedReader = new ethers.Contract(CONTRACT, ["function paused() view returns (bool)"], provider);
    if (await pausedReader.paused()) throw new Error("Token is paused");

    const value = ethers.parseUnits(amt || "0", 18);
    if (value === 0n) throw new Error("Amount must be > 0");

    // Sender balance check
    const sender = await signer.getAddress();
    const bal = await token.balanceOf(sender);
    if (value > bal) {
      throw new Error(`Amount exceeds your balance (${ethers.formatUnits(bal, 18)} XALRA)`);
    }

    note("Sending…");
    const tx = await token.transfer(to, value);
    lastSendAt = Date.now();

    const txUrl = `${EXPLORER}/tx/${tx.hash}`;
    note(`Pending: ${tx.hash}`);
    if ($("txStatus")) {
      $("txStatus").innerHTML = `Pending: <a href="${txUrl}" target="_blank" rel="noopener">${tx.hash}</a>`;
    }

    const rcpt = await tx.wait();
    if ($("txStatus")) {
      $("txStatus").innerHTML = `Confirmed in block ${rcpt.blockNumber}. <a href="${txUrl}" target="_blank" rel="noopener">View on Etherscan ↗</a>`;
    }

    // Refresh balance & pause state
    const newBal = await token.balanceOf(sender);
    if ($("myBalance")) $("myBalance").textContent = ethers.formatUnits(newBal, 18);
    await refreshPaused();
  } catch (e) {
    note(cleanError(e));
  }
};

      };

      // ===== Owner Tools =====
      const ownerEls = {
        card:       $("ownerCard"),
        status:     $("ownerStatus"),
        connectRow: $("ownerConnect"),
        connectBtn: $("ownerConnectBtn"),
        pauseBtn:   $("pauseBtn"),
        unpauseBtn: $("unpauseBtn"),
      };

      async function getAccounts() {
        if (!window.ethereum) return [];
        try { return await window.ethereum.request({ method: "eth_accounts" }); }
        catch { return []; }
      }

      async function updateOwnerUI() {
        if (!ownerEls.card) return;
        if (!window.ethereum) { ownerEls.card.style.display = "none"; ownerEls.connectRow.style.display = "none"; return; }

        let chainOk = false;
        try { chainOk = (await window.ethereum.request({ method: "eth_chainId" })) === CHAIN_ID_HEX; } catch {}

        const accounts = await getAccounts();
        const acct = (accounts[0] || "").toLowerCase();
        const isOwner = acct === OWNER;

        if (!isOwner || !chainOk) {
          ownerEls.card.style.display = "none";
          ownerEls.connectRow.style.display = "block";
          return;
        }

        ownerEls.card.style.display = "block";
        ownerEls.connectRow.style.display = "none";

        try {
          const provider = new ethers.BrowserProvider(window.ethereum);
          const signer   = await provider.getSigner();
          const c = new ethers.Contract(CONTRACT, OWNER_ABI, signer);
          const paused = await c.paused();
          ownerEls.status.textContent = paused ? "Paused" : "Active";
          ownerEls.status.style.color = paused ? "#ffd166" : "#a7f3d0";
        } catch {
          ownerEls.status.textContent = "Error";
          ownerEls.status.style.color = "#ffd166";
        }
      }

      ownerEls.connectBtn?.addEventListener("click", async () => {
        if (!window.ethereum) { alert("No wallet found"); return; }
        try {
          await ensureSepolia();
          await window.ethereum.request({ method: "eth_requestAccounts" });
          await updateOwnerUI();
        } catch (e) { alert(cleanError(e)); }
      });

      ownerEls.pauseBtn?.addEventListener("click", async () => {
        try {
          if (!window.ethereum) return alert("No wallet");
          await ensureSepolia();
          const provider = new ethers.BrowserProvider(window.ethereum);
          const signer   = await provider.getSigner();
          const c = new ethers.Contract(CONTRACT, OWNER_ABI, signer);
          ownerEls.status.textContent = "Pausing…";
          const tx = await c.pause();
          await tx.wait();
          ownerEls.status.textContent = "Paused";
          ownerEls.status.style.color = "#ffd166";
        } catch (e) { alert(cleanError(e)); await updateOwnerUI(); }
      });

      ownerEls.unpauseBtn?.addEventListener("click", async () => {
        try {
          if (!window.ethereum) return alert("No wallet");
          await ensureSepolia();
          const provider = new ethers.BrowserProvider(window.ethereum);
          const signer   = await provider.getSigner();
          const c = new ethers.Contract(CONTRACT, OWNER_ABI, signer);
          ownerEls.status.textContent = "Unpausing…";
          const tx = await c.unpause();
          await tx.wait();
          ownerEls.status.textContent = "Active";
          ownerEls.status.style.color = "#a7f3d0";
        } catch (e) { alert(cleanError(e)); await updateOwnerUI(); }
      });

      // React to wallet changes
      if (window.ethereum?.on) {
        window.ethereum.on("accountsChanged", () => { updateOwnerUI(); });
        window.ethereum.on("chainChanged",   () => { updateOwnerUI(); });
      }

      // First paint
      updateOwnerUI();
      // === Balances panel (read-only) ===
(function setupBalancesPanel() {
  const addrBox   = document.getElementById("addrList");
  const listEl    = document.getElementById("balancesList");
  const totalEl   = document.getElementById("balancesTotal");
  const btnRef    = document.getElementById("refreshBalances");
  const btnClear  = document.getElementById("clearBalances");

  if (!addrBox || !listEl || !totalEl || !btnRef) return; // panel not present

  const dedupe = (arr) => Array.from(new Set(arr.map(a => a.toLowerCase())));
  const parseAddrs = (text) =>
    (text || "")
      .split(/[\s,;]+/g)
      .map(s => s.trim())
      .filter(Boolean)
      .filter(ethers.isAddress);

  function row(addr, text, isErr) {
    const r = document.createElement("div");
    r.style.cssText = "display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px solid #1f2737;";
    const left = document.createElement("code"); left.textContent = addr;
    const right = document.createElement("strong"); right.textContent = text;
    if (isErr) right.style.color = "#ffd166";
    r.append(left, right);
    listEl.appendChild(r);
  }

  async function refresh() {
    try {
      if (!window.ethereum) { listEl.innerHTML = ""; row("-", "Wallet not detected", true); totalEl.textContent = "–"; return; }

      // Try to be on Sepolia (no-op if already there)
      try { await ensureSepolia(); } catch {}

      const provider = new ethers.BrowserProvider(window.ethereum);
      const tokenRO  = new ethers.Contract(CONTRACT, TOKEN_ABI, provider);

      // Parse & de-duplicate addresses from textarea
      const inputAddrs = dedupe(parseAddrs(addrBox.value));
      if (inputAddrs.length === 0) {
        listEl.innerHTML = ""; row("-", "No valid addresses", true); totalEl.textContent = "–"; return;
      }

      listEl.innerHTML = "";
      let total = 0n;

      const results = await Promise.allSettled(inputAddrs.map(a => tokenRO.balanceOf(a)));
      results.forEach((res, i) => {
        const addr = inputAddrs[i];
        if (res.status === "fulfilled") {
          const bal = res.value;
          total += bal;
          row(addr, ethers.formatUnits(bal, 18), false);
        } else {
          row(addr, "Error", true);
        }
      });

      totalEl.textContent = ethers.formatUnits(total, 18);
    } catch (e) {
      const msg = (e?.message || String(e));
      listEl.innerHTML = "";
      row("-", msg, true);
      totalEl.textContent = "–";
    }
  }

  async function addConnectedOnce() {
    try {
      if (!window.ethereum) return;
      const accounts = await window.ethereum.request({ method: "eth_accounts" });
      const me = (accounts[0] || "").toLowerCase();
      if (ethers.isAddress(me)) {
        const current = dedupe(parseAddrs(addrBox.value));
        if (!current.includes(me)) {
          addrBox.value = (addrBox.value.trim() + "\n" + me).trim() + "\n";
        }
      }
    } catch {}
  }

  btnRef.addEventListener("click", refresh);
  btnClear?.addEventListener("click", () => { addrBox.value = ""; listEl.innerHTML = ""; totalEl.textContent = "–"; });

  if (window.ethereum?.on) {
    window.ethereum.on("accountsChanged", async () => { await addConnectedOnce(); await refresh(); });
    window.ethereum.on("chainChanged",    async () => { await refresh(); });
  }

  // Initial population
  addConnectedOnce().then(refresh);
})();

    }

    // Start after page load; if ethers doesn't exist, show a note
    window.addEventListener("load", () => {
      if (typeof window.ethers === "undefined") {
        alert("Failed to load ethers.js");
      } else {
        onLoad();
      }
    });
  })();
  </script>
</body>
</html>
