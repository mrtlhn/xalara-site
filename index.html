<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Xalara (XALRA) — Official Site</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Xalara (XALRA) — ERC‑20 token on Ethereum & Sepolia. Contract, links, wallet helpers, and Xalara Pass (NFT) mint." />
  <link rel="canonical" href="https://xalara.io/" />
  <meta property="og:title" content="Xalara (XALRA)" />
  <meta property="og:description" content="Official token page for Xalara (XALRA). Contract, links, wallet helpers, and Xalara Pass (NFT) mint." />
  <meta property="og:type" content="website" />
  <style>
    :root { --bg:#0b0d12; --card:#121621; --text:#e7edf5; --muted:#98a3b3; --accent:#6ee7ff; --accent2:#a78bfa; }
    * { box-sizing: border-box; }
    body { margin:0; font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial; color:var(--text); background:radial-gradient(1200px 600px at 80% -10%, #1b2131 0%, #0b0d12 60%); }
    .wrap { max-width: 960px; margin: 0 auto; padding: 24px; }
    header { padding: 24px 0 8px; }
    h1 { margin:0 0 6px; font-size: clamp(28px, 4vw, 40px); letter-spacing:.2px; }
    .subtitle { color:var(--muted); margin:0 0 18px; }
    .card { background:var(--card); border:1px solid #1f2737; border-radius:14px; padding:18px; margin:16px 0; box-shadow: 0 8px 24px rgba(0,0,0,.35); }
    .grid { display:grid; gap:16px; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); }
    code { background:#0e1320; border:1px solid #1b2233; padding:4px 8px; border-radius:8px; font-family: ui-monospace,SFMono-Regular,Menlo,Consolas,"Liberation Mono",monospace; color:#cfe1ff; word-break: break-all; }
    button { cursor: pointer; border:1px solid #2a3550; background:#141a29; color:#eaf2ff; padding:10px 14px; border-radius:10px; font-weight:600; transition:.15s ease; }
    button:hover { border-color:#3b4670; transform: translateY(-1px); }
    .btn-row { display:flex; flex-wrap:wrap; gap:10px; margin-top:10px; }
    .tag { display:inline-flex; align-items:center; gap:8px; padding:4px 10px; border-radius:999px; background:#0e1320; border:1px solid #1b2233; color:#cde0ff; font-size:13px; }
    .muted { color: var(--muted); }
    .warn  { color:#ffd166; }
    footer { color: var(--muted); font-size: 13px; padding: 18px 6px 36px; }
    a { color: #84c5ff; text-decoration: none; }
    a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>⚡ Xalara <span class="muted">(XALRA)</span></h1>
      <p class="subtitle">Official site · ERC‑20 on <strong>Ethereum & Sepolia</strong> · xalara.io</p>
      <div id="networkNote" class="tag">Checking wallet network…</div>
    </header>

    <!-- Contract card -->
    <section id="contract" class="card">
      <h2>Contract</h2>
      <p><strong>Address:</strong> <code id="addr">—</code></p>
      <div class="btn-row">
        <button id="copy">Copy address</button>
        <a id="etherscan" class="tag" href="#" target="_blank" rel="noopener">View on Etherscan ↗</a>
        <button id="add">Add XALRA to MetaMask</button>
      </div>
      <p class="muted" style="margin-top:10px">Symbol: <strong>XALRA</strong> · Decimals: <strong>18</strong> · Total Supply: <strong>1,000,000,000</strong></p>
    </section>

    <!-- About -->
    <section class="card">
      <h2>About Xalara</h2>
      <div class="grid">
        <div>
          <p><strong>Standard:</strong> ERC‑20</p>
          <p><strong>Features:</strong> Burnable, Pausable, Permit (EIP‑2612)</p>
          <p><strong>Owner (per chain):</strong></p>
         <ul class="muted" style="margin:6px 0 0 0; padding-left:18px">
  <li>Mainnet: <code>0x5aBB817aaE8C17fBc97D2E2b4f08B35457aA1405</code></li>
  <li>Sepolia: <code>0x3Ba4a3CeDAA7f10791BEA807eA03Ef808Fb3b31b</code></li>
</ul>

        </div>
        <div>
          <p><strong>Source:</strong> Verified on Etherscan &amp; Sourcify</p>
          <ul>
            <li><a id="codeLink" href="#" target="_blank" rel="noopener">Contract Code ↗</a></li>
          </ul>
        </div>
      </div>
    </section>

    <!-- Important -->
    <section class="card">
      <h2>Important</h2>
      <p class="warn">The Sepolia token is for development and demonstration. It has <strong>no financial value</strong> and is <strong>not an investment</strong>.</p>
    </section>

    <!-- Xalara Pass (NFT, Sepolia only) -->
    <section class="card" id="pass" style="display:none">
      <h2>Xalara Pass</h2>
      <p>Burn <strong>100 XALRA</strong> to mint a membership pass (ERC‑721, Sepolia only).</p>
      <div class="btn-row">
        <button id="mintPass">Mint Pass</button>
        <a id="passScan" class="tag" href="#" target="_blank" rel="noopener">Pass on Etherscan ↗</a>
      </div>
      <p class="muted" id="passStatus"></p>
    </section>

    <!-- Owner Tools (owner-only, per chain) -->
    <section id="ownerCard" class="card" style="display:none">
      <h2>Owner Tools</h2>
      <div class="tag">Status: <strong id="ownerStatus">Checking…</strong></div>
      <div class="btn-row" style="margin-top:12px">
        <button id="pauseBtn">Pause transfers</button>
        <button id="unpauseBtn">Unpause transfers</button>
        <button id="renounceBtn" disabled title="Disabled for safety">Renounce ownership (disabled)</button>
      </div>
      <div id="ownerConnect" class="btn-row" style="display:none; margin-top:12px">
        <button id="ownerConnectBtn">Connect wallet</button>
      </div>
      <p class="muted" style="margin-top:10px">
        Visible only to the owner on the <em>current chain</em>. Actions require gas.
      </p>
    </section>

    <!-- Try it panel (Sepolia demo) -->
    <section class="card" id="try">
      <h2>Try it (Demo — Sepolia)</h2>
      <div class="btn-row">
        <button id="connect">Connect wallet</button>
        <button id="switch">Switch to Sepolia</button>
        <button id="addToken">Add XALRA to MetaMask</button>
      </div>
      <p id="addrRow" class="muted" style="display:none">Wallet: <code id="walletAddr">–</code></p>
      <p>My XALRA balance: <strong id="myBalance">–</strong></p>
      <div style="margin-top:12px">
        <label>Send to: <input id="to" placeholder="0x..." style="width:340px"></label>
        <label style="margin-left:10px">Amount (XALRA): <input id="amount" type="number" step="0.0001" min="0" style="width:140px"></label>
        <label class="tag" style="margin-top:8px; display:inline-flex; gap:8px; align-items:center;">
          <input type="checkbox" id="enableSend"> Enable sending
        </label>
        <button id="send">Send</button>
        <p class="muted" style="margin-top:6px">
          Safety: if you enter more than 100 XALRA, you’ll be asked to confirm.
        </p>
      </div>
      <p class="muted" id="txStatus"></p>
    </section>

    <!-- Balances (read-only) -->
    <section class="card" id="balancesCard">
      <h2>Balances</h2>
      <p class="muted">
        Read-only via your wallet provider. Enter addresses (one per line or separated by commas),
        then click <strong>Refresh</strong>. Your connected wallet will be added automatically.
      </p>

      <textarea id="addrList" rows="4" style="width:100%; background:#0e1320; color:#cfe1ff;
        border:1px solid #1b2233; border-radius:8px; padding:8px;">
0x3Ba4a3CeDAA7f10791BEA807eA03Ef808Fb3b31b
      </textarea>

      <div class="btn-row">
        <button id="refreshBalances">Refresh</button>
        <button id="clearBalances" style="opacity:.85">Clear</button>
      </div>

      <div id="balancesList" style="margin-top:8px"></div>
      <p class="muted">Total (listed): <strong id="balancesTotal">–</strong> XALRA</p>
    </section>
    <!-- How to Buy (Mainnet) -->
<section class="card" id="howto">
  <h2>How to buy XALRA</h2>
  <ol style="margin:0; padding-left:18px">
    <li>Open <a id="buyUniswap" target="_blank" rel="noopener">Uniswap on Ethereum</a>.</li>
    <li>In the token selector, paste the XALRA address:
      <code>0x20F58aC708D2ebBA5f4B6f1687073f631714f9F3</code>.
    </li>
    <li>Select <strong>ETH → XALRA</strong>, set slippage to <strong>0.5–1%</strong>, and swap.</li>
  </ol>
  <p class="muted" style="margin-top:10px">
    Tip: If Uniswap shows “Unknown token”, click “Import” (normal for new tokens).
    Always verify the contract address.
  </p>
</section>


    <!-- Trade (Mainnet) -->
    <section class="card" id="trade">
      <h2>Trade</h2>
      <p class="muted">Mainnet links for convenience.</p>
      <ul style="margin:0; padding-left:18px">
        <li>
          <a id="swapLink" target="_blank" rel="noopener">
            Swap ETH → XALRA on Uniswap ↗
          </a>
        </li>
        <li>
          <a id="addLiqLink" target="_blank" rel="noopener">
            Add liquidity (ETH + XALRA) ↗
          </a>
        </li>
        <li>
          <a id="pairInfoLink" target="_blank" rel="noopener">
            View pool on a DEX tracker ↗
          </a>
          <span class="muted" style="font-size:12px"> (set once you have the pair address)</span>
        </li>
      </ul>
    </section>

    <footer>
      © <span id="year"></span> Xalara · Network: <span id="footerNet">—</span>
    </footer>
  </div>

  <!-- ethers.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.13.2/dist/ethers.umd.min.js" crossorigin="anonymous"></script>

  <!-- App logic -->
  <script>
  (function () {
    // === MAINNET ADDRESSES (for Trade links) ===
    const MAINNET_TOKEN = "0x20F58aC708D2ebBA5f4B6f1687073f631714f9F3"; // XALRA (mainnet)
    const UNIV2_ROUTER  = "0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D"; // Uniswap V2 Router (canonical)
    let   MAINNET_PAIR  = "0x87D0F6e909C459B1dA253F1A9570cceC8F59Bb91"; 

    // === OWNERS PER CHAIN (EOA for Sepolia demo; Safe for mainnet) ===
    const OWNERS = {
  1:        "0x5aBB817aaE8C17fBc97D2E2b4f08B35457aA1405".toLowerCase(), // Mainnet owner = Safe
  11155111: "0x3Ba4a3CeDAA7f10791BEA807eA03Ef808Fb3b31b".toLowerCase(), // Sepolia owner
};

    // === NETWORKS ===
    const NETS = {
      1: {
        name: "Ethereum Mainnet",
        chainIdHex: "0x1",
        explorer: "https://etherscan.io",
        contract: "0x20F58aC708D2ebBA5f4B6f1687073f631714f9F3", // XALRA Mainnet
        pass: null,
      },
      11155111: {
        name: "Sepolia",
        chainIdHex: "0xaa36a7",
        explorer: "https://sepolia.etherscan.io",
        contract: "0x6cC3acc5A3AA8988C67285fb7954Cd51EC9B5F16", // XALRA Sepolia
        pass: "0x0366Fbc855907e3c089bDFA014FBF3c42CB6aC11", // XalaraPass Sepolia
      },
    };

    let CURRENT = NETS[11155111]; // default to Sepolia until wallet is read

    // === ABIs ===
    const TOKEN_ABI = [
      "function name() view returns (string)",
      "function symbol() view returns (string)",
      "function decimals() view returns (uint8)",
      "function totalSupply() view returns (uint256)",
      "function balanceOf(address) view returns (uint256)",
      "function transfer(address,uint256) returns (bool)",
      "function approve(address,uint256) returns (bool)"
    ];
    const OWNER_ABI = [
      "function paused() view returns (bool)",
      "function pause()",
      "function unpause()",
      "function owner() view returns (address)"
    ];
    const PASS_ABI = [
      "function mintWithBurn() returns (uint256)",
      "function balanceOf(address) view returns (uint256)",
      "function tokenURI(uint256) view returns (string)",
      "function burnPerPass() view returns (uint256)"
    ];

    // === HELPERS ===
    const $ = (id) => document.getElementById(id);
    const note = (msg) => { const el = $("txStatus"); if (el) el.textContent = msg; console.log("[XALRA]", msg); };
    const notePass = (msg) => { const el = $("passStatus"); if (el) el.textContent = msg; console.log("[PASS]", msg); };
    const cleanError = (e) => (e?.error?.message || e?.data?.message || e?.message || String(e)).replace(/^execution reverted:? /i, "");
    function updateTradeLinks() {
  const buyUniswap   = document.getElementById("buyUniswap");
  const swapLink     = document.getElementById("swapLink");
  const addLiqLink   = document.getElementById("addLiqLink");
  const pairInfoLink = document.getElementById("pairInfoLink");

  // Uniswap swap (ETH -> XALRA)
  const swapUrl = `https://app.uniswap.org/#/swap?inputCurrency=ETH&outputCurrency=${MAINNET_TOKEN}&chain=ethereum`;
  if (buyUniswap)  buyUniswap.href  = swapUrl;
  if (swapLink)    swapLink.href    = swapUrl;

  // Uniswap V2 add liquidity
  const addUrl = `https://app.uniswap.org/#/add/v2/ETH/${MAINNET_TOKEN}?chain=ethereum`;
  if (addLiqLink)  addLiqLink.href  = addUrl;

  // Pool info on a tracker (DexScreener)
  if (pairInfoLink && MAINNET_PAIR) {
    pairInfoLink.href = `https://dexscreener.com/ethereum/${MAINNET_PAIR}`;
  }
}


    async function ensureChain(chainIdHex) {
      if (!window.ethereum) throw new Error("Wallet not detected");
      const id = await window.ethereum.request({ method: "eth_chainId" });
      if (id !== chainIdHex) {
        try {
          await window.ethereum.request({ method: "wallet_switchEthereumChain", params: [{ chainId: chainIdHex }] });
        } catch (e) {
          if (e && e.code === 4902) {
            const net = Object.values(NETS).find(n => n.chainIdHex === chainIdHex);
            await window.ethereum.request({
              method: "wallet_addEthereumChain",
              params: [{
                chainId: chainIdHex,
                chainName: net?.name || "Ethereum",
                nativeCurrency: { name: "ETH", symbol: "ETH", decimals: 18 },
                rpcUrls: ["https://rpc.sepolia.org"],
                blockExplorerUrls: [net?.explorer || "https://etherscan.io"],
              }],
            });
          } else { throw e; }
        }
      }
    }

    // Update CURRENT and UI based on wallet chain
    async function setCurrentByWallet() {
      const badge = $("networkNote");
      const addrEl = $("addr");
      const escan = $("etherscan");
      const codeLink = $("codeLink");
      const footerNet = $("footerNet");
      const passCard = $("pass");
      const passScan = $("passScan");
      const tryCard = $("try");
      const sendBtn = $("send");
      const enableCb = $("enableSend");
      const txStatus = $("txStatus");

      if (!window.ethereum) {
        CURRENT = NETS[11155111];
      } else {
        const idHex = await window.ethereum.request({ method: "eth_chainId" });
        const id = parseInt(idHex, 16);
        CURRENT = NETS[id] || NETS[11155111];
      }

      // Contract card + links
      if (addrEl) addrEl.textContent = CURRENT.contract;
      if (escan) escan.href = `${CURRENT.explorer}/address/${CURRENT.contract}#code`;
      if (codeLink) codeLink.href = `${CURRENT.explorer}/address/${CURRENT.contract}#code`;
      if (badge) badge.textContent = `Wallet network: ${CURRENT.name} ✓`;
      if (footerNet) footerNet.textContent = CURRENT.name;

      // Pass card (Sepolia only)
      if (passCard) {
        const onSepolia = CURRENT === NETS[11155111];
        passCard.style.display = onSepolia ? "block" : "none";
        if (onSepolia && passScan) passScan.href = `${NETS[11155111].explorer}/address/${NETS[11155111].pass}#code`;
      }

      // Demo Try panel: disabled on mainnet
      if (tryCard && sendBtn) {
        const onMainnet = CURRENT === NETS[1];
        sendBtn.disabled = onMainnet || !(enableCb?.checked);
        if (txStatus) {
          txStatus.textContent = onMainnet ? "Demo transfers are only enabled on Sepolia." : "";
        }
      }
    }

    // React to wallet chain change
    if (window.ethereum?.on) {
      window.ethereum.on("chainChanged", setCurrentByWallet);
    }

    function onLoad() {
      if ($("year")) $("year").textContent = new Date().getFullYear();

      // Initial network-derived UI
      setCurrentByWallet();
        updateTradeLinks();


      // Contract card buttons
      $("copy")?.addEventListener("click", async () => {
        try {
          await navigator.clipboard.writeText(CURRENT.contract);
          const btn = $("copy"); const old = btn.textContent; btn.textContent = "Copied!"; setTimeout(() => btn.textContent = old, 1200);
        } catch {}
      });
      $("add")?.addEventListener("click", async () => {
        if (!window.ethereum) return alert("MetaMask not detected.");
        try {
          await window.ethereum.request({
            method: "wallet_watchAsset",
            params: { type: "ERC20", options: { address: CURRENT.contract, symbol: "XALRA", decimals: 18 } }
          });
        } catch (e) { alert(cleanError(e)); }
      });

      // === Trade links (mainnet) — exact wiring ===
      {
        const swapLink   = $("swapLink");
        const addLiqLink = $("addLiqLink");
        const pairInfo   = $("pairInfoLink");

        // Uniswap UI: swap ETH -> XALRA (mainnet)
        if (swapLink) {
          swapLink.href = `https://app.uniswap.org/#/swap?outputCurrency=${MAINNET_TOKEN}&chain=mainnet`;
        }

        // Uniswap UI: add liquidity (ETH + XALRA) on v2 (mainnet)
        if (addLiqLink) {
          addLiqLink.href = `https://app.uniswap.org/#/add/v2/ETH/${MAINNET_TOKEN}?chain=mainnet`;
        }

        // Pool tracker link (fill MAINNET_PAIR once known)
        if (pairInfo) {
          if (MAINNET_PAIR) {
            pairInfo.href = `https://dexscreener.com/ethereum/${MAINNET_PAIR}`;
            pairInfo.style.opacity = 1;
          } else {
            pairInfo.removeAttribute("href");
            pairInfo.style.opacity = 0.75;
            pairInfo.textContent = "View pool on a DEX tracker (set pair address after pool is created)";
          }
        }
      }

      // ---- Try panel (send; Sepolia only) ----
      let provider, signer, token;
      const btnConnect  = $("connect");
      const btnSwitch   = $("switch");
      const btnAddToken = $("addToken");
      const btnSend     = $("send");
      let lastSendAt = 0;
      const SEND_COOLDOWN_MS = 8000;

      async function connect() {
        if (!window.ethereum) throw new Error("MetaMask not detected");
        provider = new ethers.BrowserProvider(window.ethereum);
        await window.ethereum.request({ method: "eth_requestAccounts" });
        // ensure Sepolia for demo
        await ensureChain(NETS[11155111].chainIdHex);
        await setCurrentByWallet();

        signer = await provider.getSigner();
        token  = new ethers.Contract(CURRENT.contract, TOKEN_ABI, signer);

        const addr = await signer.getAddress();
        $("walletAddr") && ($("walletAddr").textContent = addr);
        $("addrRow") && ( $("addrRow").style.display = "block" );

        const bal = await token.balanceOf(addr);
        $("myBalance") && ( $("myBalance").textContent = ethers.formatUnits(bal, 18) );

        note("Connected.");
        await updateOwnerUI();
      }

      const tryEls = {
        card: $("try"),
        sendBtn: $("send"),
        enable: $("enableSend"),
        status: $("txStatus"),
      };

      function setTryPaused(paused) {
        if (!tryEls.card) return;
        tryEls.card.style.opacity = paused ? 0.6 : 1;
        const enabledToggle = tryEls.enable?.checked ?? false;
        if (tryEls.sendBtn) tryEls.sendBtn.disabled = paused || !enabledToggle || (CURRENT === NETS[1]);
        if (tryEls.status) {
          if (CURRENT === NETS[1]) {
            tryEls.status.textContent = "Demo transfers are only enabled on Sepolia.";
          } else {
            tryEls.status.textContent = paused ? "Token is paused: transfers are disabled." : "";
          }
        }
      }

      async function refreshPaused() {
        if (!window.ethereum) return;
        try {
          const pro = new ethers.BrowserProvider(window.ethereum);
          const c = new ethers.Contract(CURRENT.contract, ["function paused() view returns (bool)"], pro);
          const paused = await c.paused();
          setTryPaused(paused);
        } catch { /* ignore */ }
      }

      if (tryEls.enable && tryEls.sendBtn) {
        tryEls.sendBtn.disabled = true; // require explicit toggle
        tryEls.enable.addEventListener("change", refreshPaused);
      }
      if (window.ethereum?.on) {
        window.ethereum.on("accountsChanged", refreshPaused);
        window.ethereum.on("chainChanged",   refreshPaused);
      }
      refreshPaused();

      btnConnect && (btnConnect.onclick = () => connect().catch(e => note(cleanError(e))));
      btnSwitch  && (btnSwitch.onclick  = () => {
        if (!window.ethereum) { note("MetaMask not detected"); return; }
        window.ethereum.request({ method: "wallet_switchEthereumChain", params: [{ chainId: NETS[11155111].chainIdHex }] })
          .catch(e => note(cleanError(e)));
      });
      btnAddToken && (btnAddToken.onclick = async () => {
        try {
          if (!window.ethereum) throw new Error("MetaMask not detected");
          await window.ethereum.request({
            method: "wallet_watchAsset",
            params: { type: "ERC20", options: { address: CURRENT.contract, symbol: "XALRA", decimals: 18 } }
          });
        } catch (e) { note(cleanError(e)); }
      });

      btnSend && (btnSend.onclick = async () => {
        try {
          if (CURRENT !== NETS[11155111]) { note("Demo transfers are only enabled on Sepolia."); return; }
          if (!tryEls.enable?.checked) { note("Toggle “Enable sending” first."); return; }
          const now = Date.now();
          if (now - lastSendAt < SEND_COOLDOWN_MS) {
            const wait = Math.ceil((SEND_COOLDOWN_MS - (now - lastSendAt)) / 1000);
            note(`Please wait ${wait}s before sending again.`);
            return;
          }
          if (!signer) await connect();

          const to = ($("to")?.value || "").trim();
          const amtStr = ($("amount")?.value || "").trim();
          if (!ethers.isAddress(to)) throw new Error("Invalid recipient address");
          if (!amtStr || Number(amtStr) <= 0) throw new Error("Enter a positive amount");

          // Respect paused()
          const providerRO = new ethers.BrowserProvider(window.ethereum);
          const pausedReader = new ethers.Contract(CURRENT.contract, ["function paused() view returns (bool)"], providerRO);
          if (await pausedReader.paused()) throw new Error("Token is paused");

          const value = ethers.parseUnits(amtStr, 18);

          // Optional soft cap confirm
          const SOFT_CAP = ethers.parseUnits("100", 18);
          if (value > SOFT_CAP) {
            const ok = confirm("This is a demo site. Are you sure you want to send more than 100 XALRA?");
            if (!ok) return;
          }

          const sender = await signer.getAddress();
          const bal = await token.balanceOf(sender);
          if (value > bal) throw new Error(`Amount exceeds your balance (${ethers.formatUnits(bal, 18)} XALRA)`);

          note("Sending…");
          const tx = await token.transfer(to, value);
          lastSendAt = Date.now();

          const hash = tx.hash;
          const el = $("txStatus");
          const txUrl = `${CURRENT.explorer}/tx/${hash}`;
          if (el && /^0x[0-9a-fA-F]{64}$/.test(hash)) {
            el.innerHTML = `Pending: <a href="${txUrl}" target="_blank" rel="noopener">${hash.slice(0,10)}…</a>`;
          } else {
            note("Pending: " + hash);
          }

          const rcpt = await tx.wait();
          if (el) {
            el.innerHTML = `Confirmed in block ${rcpt.blockNumber}. <a href="${txUrl}" target="_blank" rel="noopener">View on Etherscan</a>`;
          } else {
            note(`Confirmed in block ${rcpt.blockNumber}. Tx: ${hash}`);
          }

          const newBal = await token.balanceOf(sender);
          $("myBalance") && ( $("myBalance").textContent = ethers.formatUnits(newBal, 18) );
          await refreshPaused();
        } catch (e) {
          note(cleanError(e));
        }
      });

      // ---- Owner Tools (per chain owner) ----
      const ownerEls = {
        card:       $("ownerCard"),
        status:     $("ownerStatus"),
        connectRow: $("ownerConnect"),
        connectBtn: $("ownerConnectBtn"),
        pauseBtn:   $("pauseBtn"),
        unpauseBtn: $("unpauseBtn"),
      };

      async function getAccounts() {
        if (!window.ethereum) return [];
        try { return await window.ethereum.request({ method: "eth_accounts" }); }
        catch { return []; }
      }

      async function updateOwnerUI() {
        if (!ownerEls.card) return;
        if (!window.ethereum) { ownerEls.card.style.display = "none"; ownerEls.connectRow.style.display = "none"; return; }

        let chainId = 11155111;
        try { chainId = parseInt(await window.ethereum.request({ method: "eth_chainId" }), 16); } catch {}
        const accounts = await getAccounts();
        const acct = (accounts[0] || "").toLowerCase();
        const ownerForChain = OWNERS[chainId] || "";
        const isOwner = acct === ownerForChain;

        // Note: on mainnet owner is a Safe; direct EOA calls will not succeed.
        if (!isOwner || chainId === 1) {
          ownerEls.card.style.display = "none";
          ownerEls.connectRow.style.display = "block";
          return;
        }

        ownerEls.card.style.display = "block";
        ownerEls.connectRow.style.display = "none";

        try {
          const providerO = new ethers.BrowserProvider(window.ethereum);
          const signerO   = await providerO.getSigner();
          const c = new ethers.Contract(CURRENT.contract, OWNER_ABI, signerO);
          const paused = await c.paused();
          ownerEls.status.textContent = paused ? "Paused" : "Active";
          ownerEls.status.style.color = paused ? "#ffd166" : "#a7f3d0";
          setTryPaused(paused);
        } catch {
          ownerEls.status.textContent = "Error";
          ownerEls.status.style.color = "#ffd166";
        }
      }

      ownerEls.connectBtn?.addEventListener("click", async () => {
        if (!window.ethereum) { alert("No wallet found"); return; }
        try {
          await window.ethereum.request({ method: "eth_requestAccounts" });
          await updateOwnerUI();
        } catch (e) { alert(cleanError(e)); }
      });

      ownerEls.pauseBtn?.addEventListener("click", async () => {
        try {
          if (!window.ethereum) return alert("No wallet");
          const providerO = new ethers.BrowserProvider(window.ethereum);
          const signerO   = await providerO.getSigner();
          const c = new ethers.Contract(CURRENT.contract, OWNER_ABI, signerO);
          ownerEls.status.textContent = "Pausing…";
          const tx = await c.pause();
          await tx.wait();
          ownerEls.status.textContent = "Paused";
          ownerEls.status.style.color = "#ffd166";
          setTryPaused(true);
        } catch (e) { alert(cleanError(e)); await updateOwnerUI(); }
      });

      ownerEls.unpauseBtn?.addEventListener("click", async () => {
        try {
          if (!window.ethereum) return alert("No wallet");
          const providerO = new ethers.BrowserProvider(window.ethereum);
          const signerO   = await providerO.getSigner();
          const c = new ethers.Contract(CURRENT.contract, OWNER_ABI, signerO);
          ownerEls.status.textContent = "Unpausing…";
          const tx = await c.unpause();
          await tx.wait();
          ownerEls.status.textContent = "Active";
          ownerEls.status.style.color = "#a7f3d0";
          setTryPaused(false);
        } catch (e) { alert(cleanError(e)); await updateOwnerUI(); }
      });

      if (window.ethereum?.on) {
        window.ethereum.on("accountsChanged", () => { updateOwnerUI(); });
        window.ethereum.on("chainChanged",   () => { updateOwnerUI(); setCurrentByWallet(); });
      }

      // ---- Xalara Pass (Sepolia only) ----
      const mintBtn = $("mintPass");
      mintBtn && (mintBtn.onclick = async () => {
        try {
          if (!window.ethereum) throw new Error("Wallet not detected");
          await ensureChain(NETS[11155111].chainIdHex);
          await setCurrentByWallet();

          const provider = new ethers.BrowserProvider(window.ethereum);
          const signer   = await provider.getSigner();

          const token = new ethers.Contract(NETS[11155111].contract, TOKEN_ABI, signer);
          const passAddr = NETS[11155111].pass;
          const pass  = new ethers.Contract(passAddr, PASS_ABI, signer);

          let burnAmount = ethers.parseUnits("100", 18);
          try { burnAmount = await pass.burnPerPass(); } catch {}

          const me = await signer.getAddress();
          const bal = await token.balanceOf(me);
          if (bal < burnAmount) {
            throw new Error(`You need ${ethers.formatUnits(burnAmount,18)} XALRA to mint a pass. Your balance is ${ethers.formatUnits(bal,18)}.`);
          }

          notePass("Approving XALRA for burn…");
          let tx = await token.approve(passAddr, burnAmount);
          await tx.wait();

          notePass("Minting pass…");
          tx = await pass.mintWithBurn();
          const rcpt = await tx.wait();

          const txUrl = `${NETS[11155111].explorer}/tx/${tx.hash}`;
          $("passStatus").innerHTML = `Minted! <a href="${txUrl}" target="_blank" rel="noopener">View transaction ↗</a>`;

          try {
            const newBal = await token.balanceOf(me);
            $("myBalance") && ( $("myBalance").textContent = ethers.formatUnits(newBal, 18) );
          } catch {}
        } catch (e) {
          notePass(cleanError(e));
        }
      });

      // ---- Balances panel (read-only, current chain) ----
      (function setupBalancesPanel() {
        const addrBox   = $("addrList");
        const listEl    = $("balancesList");
        const totalEl   = $("balancesTotal");
        const btnRef    = $("refreshBalances");
        const btnClear  = $("clearBalances");
        if (!addrBox || !listEl || !totalEl || !btnRef) return;

        const dedupe = (arr) => Array.from(new Set(arr.map(a => a.toLowerCase())));
        const parseAddrs = (text) =>
          (text || "")
            .split(/[\s,;]+/g)
            .map(s => s.trim())
            .filter(Boolean)
            .filter(ethers.isAddress);

        function row(addr, text, isErr) {
          const r = document.createElement("div");
          r.style.cssText = "display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px solid #1f2737;";
          const left = document.createElement("code"); left.textContent = addr;
          const right = document.createElement("strong"); right.textContent = text;
          if (isErr) right.style.color = "#ffd166";
          r.append(left, right);
          listEl.appendChild(r);
        }

        async function refresh() {
          try {
            if (!window.ethereum) { listEl.innerHTML = ""; row("-", "Wallet not detected", true); totalEl.textContent = "–"; return; }

            const provider = new ethers.BrowserProvider(window.ethereum);
            const tokenRO  = new ethers.Contract(CURRENT.contract, TOKEN_ABI, provider);

            const inputAddrs = dedupe(parseAddrs(addrBox.value));
            if (inputAddrs.length === 0) { listEl.innerHTML = ""; row("-", "No valid addresses", true); totalEl.textContent = "–"; return; }

            listEl.innerHTML = "";
            let total = 0n;

            const results = await Promise.allSettled(inputAddrs.map(a => tokenRO.balanceOf(a)));
            results.forEach((res, i) => {
              const addr = inputAddrs[i];
              if (res.status === "fulfilled") {
                const bal = res.value;
                total += bal;
                row(addr, ethers.formatUnits(bal, 18), false);
              } else {
                row(addr, "Error", true);
              }
            });

            totalEl.textContent = ethers.formatUnits(total, 18);
          } catch (e) {
            const msg = (e?.message || String(e));
            listEl.innerHTML = "";
            row("-", msg, true);
            totalEl.textContent = "–";
          }
        }

        async function addConnectedOnce() {
          try {
            if (!window.ethereum) return;
            const accounts = await window.ethereum.request({ method: "eth_accounts" });
            const me = (accounts[0] || "").toLowerCase();
            if (ethers.isAddress(me)) {
              const current = dedupe(parseAddrs(addrBox.value));
              if (!current.includes(me)) {
                addrBox.value = (addrBox.value.trim() + "\n" + me).trim() + "\n";
              }
            }
          } catch {}
        }

        btnRef.addEventListener("click", refresh);
        btnClear?.addEventListener("click", () => { addrBox.value = ""; listEl.innerHTML = ""; totalEl.textContent = "–"; });

        if (window.ethereum?.on) {
          window.ethereum.on("accountsChanged", async () => { await addConnectedOnce(); await refresh(); });
          window.ethereum.on("chainChanged",    async () => { await setCurrentByWallet(); await refresh(); });
        }

        addConnectedOnce().then(refresh);
      })();

      // First owner paint
      updateOwnerUI();
    }

    // Start after page load
    window.addEventListener("load", () => {
      if (typeof window.ethers === "undefined") {
        alert("Failed to load ethers.js");
      } else {
        onLoad();
      }
    });
  })();
  </script>
</body>
</html>
